#!/bin/bash

############################################################
# ascii                                                    #
############################################################
ascii_logo()
{
   # Display Help
   echo "@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@%%%%**@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@%%%%%%%%%****@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@%%%%%%%%%%%%%******@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@%%%%%%%%%%%%%%%%%(*******@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@%%%%%%%%%%%%%%%%%%%(////*******@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@&%%%%%%%%%%%%%%%%%////////////*****@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@&&&%%%%%%%%%%%%%%///////////////////***@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@&&&&&%%%%%%%%%%//////////////////////////@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@&&&&&&%%%%%%%/////////////////////////////@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@&&&&&&&&%%#///////////////////////////////@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@&&&&&&&&&#///////////////////////////////((@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@&&&&&&&&&&%%/////////////////////////((((((&@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@&&&&&&&&&&&%%%/////////////////(((((((((((((@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@&&&&&&&&&&&&&%%%//////////(((((((((((((((((((@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@&&&&&&&&&&&&%%%%(///(((((((((((((((((((((((@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@&&&&&&&&&&&%%%%%%(((((((((((((((((((((((((@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@&&&&&&&&&&%%%%%%%(((((((((((((((((((((((@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@&&&&&&&&%%%%%%%%((((((((((((((((((((((@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@&&&&&&&%%%%%%%%%(((((((((((((((((((((@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@&&&&&&%%%%%%%%%%(((((((((((((((((((@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@&&&&&&%%%%%%%%%%%(((((((((((((((((@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@&&&&&%%%%%%%%%%%%(((((((((((((((@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@&&&&%%%%%%%%%%%%%((((((((((((((@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@&&&%%%%%%%%%%%%%%((((((((((((&@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@&&%%%%%%%%%%%%%%%#((((((((((@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@&%%%%%%%%%%%%%%%%%(((((((((@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@%%%%%%%%%%%%%%%%%%(((((((@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@%%%%%%%%%%%%(((((@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@%%%%%%(((@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@"

}
############################################################
# Development Aid                                                     #
############################################################
development_setup()
{
    # Install Development Tools
    echo "Set a root password for your system:"
    passwd
    echo "Root password chanaged...!"
    
    echo "Installing OpenSSH..."
    apk add openssh
    echo "Generating Key..."
    ssh-keygen -A
    echo "Activating remote login..."
    echo 'PermitRootLogin yes' >> /etc/ssh/sshd_config
    apk add openrc --no-cache
    rc-update add sshd
    echo "Starting OpenSSH Server..."
    /etc/init.d/sshd start
}
############################################################
# Setup                                                    #
############################################################
setup()
{
    # Update
    apk update

    # Install Required Packages
    apk add python3 py3-pip nano fuse git

    # Do not install rclone from apk packge manager, it has old version
    # Installing from the offcial repo
    wget https://downloads.rclone.org/rclone-current-linux-386.zip
    unzip rclone-current-linux-386.zip
    cp rclone-v*-linux-386/rclone /bin/rclone
    rm -rf rclone-v*-linux-386
    # Create a Directory
    mkdir Obsidian

    echo "Please Select the Obsidian Folder"

    # Mount a directory TODO: Add Fix
    mount -t ios null Obsidian

    # Install syncrclone    
    python3 -m pip install git+https://github.com/Jwink3101/syncrclone

    # Create syncrclone
    syncrclone --new config.py
}
############################################################
############################################################
# Main program                                             #
############################################################
############################################################

# Running in background
cat /dev/location > /dev/null &

ascii_logo
development_setup # Comments this line if you want to skip development enviroment set-up
setup
rclone config # This will run rclone config (https://rclone.org/commands/rclone_config/)
rclone mkdir gdrive:Obsidian # You can Change gdrive with your own set-up i.e. mega
python3 update_config.py gdrive:Obsidian /root/Obsidian
